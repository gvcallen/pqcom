\graphicspath{{./figures}}

\section{Component Selection}
Components for the various sub-systems should now be selected. Through-hole components and breakout boards will mostly be used for the ground station, and surface mount components for the PQ unit. The existing stepper motors will be used, which draw 0.50 A and allow for up to $\SI{0.5}{N \cdot m}$ of torque \cite{datasheet-4118}. The mount's azimuthal zero-sensing circuit will also be used, which includes a \textit{H22A} optical switch and a low-pass filter.

\subsection{GPS}\label{sec:components_gps}
The same GPS will be selected for both the ground station and PQ unit to simplify development. A one degree pointing accuracy will be designed for, as it is an order of magnitude less than the beamwidth from Section \ref{sec:tracking}. A distance of \SI{120}{km} results in a large required accuracy of $2 \times 120 000 \times \pi \times \frac{1}{360} \approx \SI{2}{km}$. The {ATGM336H} and the \textit{ATGM332D} are two readily available options that advertise 2.5 m accuracy, which is much better than required. Since both of these also have active antenna support, and current consumption less than 100 mA, the ATGM332D-5N31 is chosen for its lower price.

\subsection{IMU}
To automatically determine absolute ground station orientation, the ground station could include an inertial measurement unit (IMU). Alternatively, a \textit{dead-reckoning} fix can be done by ensuring the ground station is flat and manually faced e.g. using a compass and statically stroed magnetic declination value. To provide maximum flexibility in the implementation stage, a 9-axis IMU, which includes both an accelerometer and a magnetometer, will be included. Since the ground station's mount will not be moving, only a low-accuracy accelerometer is assumed to be adequate for orientation. The \textit{MPU-9250} is selected, as it is inexpensive and readily available.

\subsection{RF Module}
The transceiver type for both the custom and radiosonde link needs to be considered. There are a few options in this regard, listed from more to less specialized:
\begin{itemize}
    \item Fully custom design. Here, components are discretely designed using transistors, DSPs etc. This option is listed for completeness, but is out of scope for this project.
    \item Front-End Module (FEM). For this option, the FEM provides filters, a low-noise amplifier (LNA), antenna matching, and down-conversion. Then, a controller (e.g. FPGA or MCU) needs to be designed to perform modulation/demodulation functionality (the \textit{modem}) and interface with the FEM.
    \item Dedicated Transceiver. A transceiver provides FEM and modulation functionality, however still requires RF techniques for matching, and an additional RF shield.
    \item Dedicated module. For this option, all functionality is provided in a dedicated module, with a simple antenna connection or pin-out, and an MCU interface. This method has little flexibility, since all matching and design is done internally, and the frequency band is therefore constrained, however provides high ease-of-use.
    \item Software-defined radio (SDR). This is the most general-purpose option, but does not exercise the highest performance. It is often directly connected to a PC via USB.
\end{itemize}

\subsubsection{Custom Communication}
For the custom link, a dedicated LoRa module will be used. Most of these modules include GFSK as a built-in alternative, making them ideal. All LoRa ICs are based on \textit{Semtech} chipsets due to the company's patent on the technology. Although dedicated transceivers are available, these require special RF considerations to be made, and therefore a module will be utilized to ease development. Table \ref{tab:rfModules} contrasts the two most common modules in the 433 MHz LoRa band. The RA-02 is selected due to availability.

\begin{table}[!htb]
  \centering
  \renewcommand{\arraystretch}{1.2}
  \begin{tabular}{ |c|c|c|c| }
  \hline
  \textbf{Name}   & \textbf{RX Sensitivity} & \textbf{TX Sensitivity}& \textbf{Frequency} \\
  \hline
  RA-02           & -141 dBm             & +18 dBm              & 410 to 525 MHz     \\
  RFM98           & -148 dBm             & +20 dBm              & 410 to 525 MHz     \\
  \hline
  \end{tabular}
  \caption{Comparison of two LoRa modules}
  \label{tab:rfModules}
\end{table}

\subsubsection{Radiosonde Communication}
Unfortunately, although the selected LoRa module supports GFSK demodulation, it does not receive in the meteorological band, and therefore a second receiver is needed for the radiosonde link. To cater for a wide variety of radiosondes, a software-defined radio (SDR) will be used to adjust the decoding parameters dynamically. The \textit{RTL-SDR} USB dongle is considered the standard, low-cost solution for this, and is therefore selected. An alternative option is to design a dedicated GFSK receiver which allows for adjustable parameters, however this route is not chosen due to time constraints.

\subsection{Stepper Motor Driver}
The original PCB of the previous antenna mount contained two A3972 ICs to drive the stepper motors. Although these could be de-soldered and used, it is favourable to use a newer IC for replacement in case of damage. From the driver and motor datasheets, it is realized that the drivers should operate in dual DMOS full-bridge output configuration; allow bipolar PWM current control; allow for micro-stepping; and provide $\SI{0.5}{A}$ at $\SI{24}{V}$. Very few drivers fit these exact specifications. The \textit{A4970} is considered the follow-up version of the \textit{A3972}, however is not available in a single pack or locally. The \textit{L6219} driver is found to match most specifications, while only allowing half-stepping. It is therefore selected, as there is no sound level requirement for the system, and a single step is $0.22^\circ$ and $0.45^\circ$ for the elevation and azimuthal axes respectively, which is fine-grained enough.

\subsection{RS-485 Driver}
An RS-485 driver is needed for compatibility with the PQ bus interface. Due to the project's nature (i.e. all units on the bus are in close proximity) only short-range RS-485 communication should be catered for. Further, the PQSU standard specifies no speed requirements, and therefore a minimum of 9600 baud will be designed for. The \textit{MAX485} is selected both due to its availability, and the fact that it meets these specifications.

\subsection{Microcontroller}
An MCU will be needed both on the GS and the PQ. The ESP32, Arduino, and STM32 frameworks are considered. The \textit{ESP32-WROOM-32} is a commonly available ESP32 variant which has 32 GPIO pins. It also has several ADCs, and allows for both WiFi and Bluetooth connectivity. The \textit{ATMEGA328PB} is an MCU commonly used in small Arduino boards. It has fewer pins than the ESP, is an 8-bit MCU, and has only 32 KB of flash memory, but allows a supply voltage of as low as 1.8 V, and has very low current consumption. Finally, the common \textit{STM32F411} MCU is a high-performance Arm-based MCU, advertised to have highly accurate ADCs and up to 81 GPIOs. Since the processing requirements for this project are assumed to not be high, and the ESP32 is a relatively high-performance MCU which satisfies the pin requirements, it will be selected for the GS. For the PQ unit, the ATMEGA328PB will be used, due to its exceptionally low current consumption, and many fewer pins being needed for the PQ unit.

\subsection{Power}
Both the ground station and the PocketQube should cater for the three-hour flight time. Component power calculations are listed in Tables \ref{tab:gs_component_consumption} and \ref{tab:pqunit_component_consumption}, resulting in 50 W and 453 mW for the GS and PQ respectively. A 12 V lead-acid battery will be used for the ground station. This should be capable of supplying around 4 A, resulting in a capacity requirement of 12 Ah. A more readily available 7.2 Ah battery will initially be used for development. Linear regulators will be used for the 3.3 V and 5 V supply (as opposed to switched-mode) due to their simplicity and the lack of any system-wide efficiency specifications. The 3.3 V regulator should be capable of supplying 130 mA to the RF module, GPS, and IMU, and the 5 V regulator should be capable of supplying $\SI{120}{mA} + \SI{130}{mA} = \SI{250}{mA}$ to the ESP and 3.3 V regulator. The LD1117CV and L7805CP are linear regulators which can supply up to $\SI{800}{mA}$ and $\SI{1.5}{A}$ respectively, and therefore meet these requirements. A boost converter will be used to achieve the 24 V motor drive voltage, which should support \SI{2}{A} at its \SI{12}{V} input due to the motors drawing 0.5 A per coil. A breakout board based on the XL6009 IC will be used, which meets this requirement. For the PocketQube unit, the LiPo battery should be capable of supplying around 120 mA nominally. To achieve the 3 hour specification, a capacity of 360 mAh is required. A larger 2000 mAh battery will be used for development, due to its low-cost; the added convenience of fewer discharge cycles; as well as the allowance it provides for retrieving the payload after the balloon has landed at the end of the day (around 16 hours later).